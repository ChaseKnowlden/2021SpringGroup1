<!DOCTYPE html>
<html>

<head>
    <title>Create a post template!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="wrapper">
        <div style="background-color:lavender; !important" class="jumbotron text-center bg-primary">
            <h1> Create a post template.</h1>
        </div>

        <form id="postTemplateForm" name="postTemplateForm" action="{% url 'mainapp:createPostTemplate' %}"  method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="template_name">Template name:</label>
                    <input name="template_name"></textarea>
                    <br>
                <label for="description">Template description:</label>   
                    <input name="description" rows="3"></textarea>
            </div>
            <div class="container" id="addedFields">
            </div>
            <input type="hidden" id="data_field_temps" name="data_field_temps">
        </form>
        <div class="form-group">
                <label for="AddFieldType">Field type</label>
                    <select class="form-control" id="AddFieldType">
                        <option>Text</option>
                        <option>Image</option>
                        <option>Video</option>
                    </select>
                    <button id="addField"  class="btn">Add Field</button>
        </div>
        <button id="submitTemplate"  class="btn">Submit Post Template</button>
    </div>

<script>
 document.getElementById("addField").addEventListener("click", addField)
 document.getElementById("submitTemplate").addEventListener("click", formValidation)
 function addField(e){
        var obj = document.getElementById("AddFieldType");
        var container=document.getElementById("addedFields");
        var selection=obj.options[obj.selectedIndex].text;
        console.log("addField entered");
        if(selection=="Text"){
            var i=container.childElementCount+1;
            div=document.createElement('form')
            div.appendChild(document.createTextNode(i+".Text field: "));    
            div.appendChild(document.createElement("br"));
            var nameInput = document.createElement("input");
            var typeInput= document.createElement("input");
            
            nameInput.type = "text";
            nameInput.name = "name";
            typeInput.type="hidden";
            typeInput.name="type"
            typeInput.value="text";
            
            div.appendChild(nameInput);
            div.appendChild(typeInput);
            div.appendChild(document.createElement("br"));
            container.appendChild(div);
        
            }else if(selection=="Image"){
            var i=container.childElementCount+1;
            div=document.createElement('form');
            div.appendChild(document.createTextNode(i+".Image field: "));    
            div.appendChild(document.createElement("br"));
            var nameInput = document.createElement("input");
            var typeInput= document.createElement("input");
            
            nameInput.type = "text";
            nameInput.name = "name";
            typeInput.type="hidden";
            typeInput.name="type"
            typeInput.value="image";
            
            div.appendChild(nameInput);
            div.appendChild(typeInput);
            div.appendChild(document.createElement("br"));
            container.appendChild(div);
        
        }else if(selection=="Video"){
            var i=container.childElementCount+1;
            div=document.createElement('form')
            div.appendChild(document.createTextNode(i+".Video field: "));    
            div.appendChild(document.createElement("br"));
            var nameInput = document.createElement("input");
            var typeInput= document.createElement("input");
            
            nameInput.type = "text";
            nameInput.name = "name";
            typeInput.type="hidden";
            typeInput.name="type"
            typeInput.value="video";
            
            div.appendChild(nameInput);
            div.appendChild(typeInput);
            div.appendChild(document.createElement("br"));
            container.appendChild(div);
        }
 };
 
 function formValidation(e){
 if(true){
    passJson();
    if(true)
        document.getElementById("postTemplateForm").submit();
    }
 }
 function passJson(){
        var formData = document.getElementById("addedFields").childNodes;
        var dict = []; // create an empty array
        for (let index = 0; index < formData.length; ++index) {
            let value = formData[index];
            console.log(value.tagName)
            if(value.tagName=="FORM"){
                let data = {};
                let formdata = new FormData(value);
                for (let tuple of formdata.entries()) data[tuple[0]] = tuple[1];
            
                dict.push({
                    key:   index,
                    value: data
                });
            }
            
        }
        
        var input=document.getElementById("data_field_temps");
        console.log(dict);
        input.value=JSON.stringify(dict);
        console.log(input.value)
        }
</script>

</body>

</html>